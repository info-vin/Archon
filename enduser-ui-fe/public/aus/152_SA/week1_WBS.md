# 富士達電梯排程與資料整合平台技術驗證專案範疇與目標定義書

**文件版本：** Gemini_V1.0  
**日期：** 2025年8月5日  
**專案經理：** [您的姓名/職稱]

## 1. 專案背景與目標

### 1.1 專案背景

富士達電梯目前面臨生產排程與人力調度上的挑戰，主要原因包括：

- **專案型生產為主：** 電梯製造以專案為單位，現場作業多為人工。
- **交期變動性大：** 工地延誤等外部因素導致排程困難。
- **手動排程與資料輸入：** 目前使用Excel管理大、中、小日程表，手動輸入ERP，耗時且易錯。
- **中後段排程壓力大：** 生產排程常在交期前50天才拿到生產圖面，壓縮實際排工時間。
- **人力派工困難：** 技術人員技能單一、調派彈性不足，易導致排班「卡關」。
- **IT系統現況與限制：** ERP系統老舊，MRP模組缺乏彈性；PLM系統僅作為圖面存放，未整合工程變更；外部系統（保養維修與IOT監控）由日本主導，內部變動困難；WMS專案進行中。

本次POC旨在透過SAS Viya Public Cloud平台，驗證智能排程與資料整合的可行性與效益，分階段聚焦於排程最佳化與PLM系統輔助。

### 1.2 專案目標

本專案旨在透過導入智能排程與資料整合平台，解決富士達電梯現有生產排程的痛點，提升生產效率、降低錯誤率，並為未來全面導入智能製造奠定基礎。具體目標如下：

- **動態派工與生產排程最佳化：** 整合人力、物料、工單、機台狀況等資訊，針對專案與工站進行即時調整，並考慮替代料、庫存、機台故障、人員技能多樣性與排班限制等約束條件。
- **自動化與流程優化：** 透過RPA自動填寫與轉換報表（如從大日程表到小日程表），減少人工作業，提升主管專注於決策與優化。
- **多系統資料整合：** 整合ERP、報工、PLM等多系統資料，建構統一平台，支援即時與歷史數據的分層分析。
- **智能決策支援：** 導入AI自動排程與突發事件處理（如請假、急單、設備異常），並提供場景模擬功能（A/B/C情境模擬），協助主管進行決策與對策預測。
- **視覺化呈現：** 提供視覺化儀表板，清楚呈現預排vs實排、標準工時vs實績差異。

## 2. 專案範疇

本專案將涵蓋以下核心範疇：

### 2.1 數據工程 (Data Engineering)

#### 數據來源識別與分析：

- **工時與實績數據：** 來自現有Excel報工系統，包含員工編號、工單號碼、報工日期、實際工時、報工狀態（正常/請假/缺工/異常）等。
- **PLM/製程設計數據：** 來自現有Excel檔案或系統匯出，包含工序代碼、需用技能、技能等級、設備需求、標準工時等。
- **ERP系統數據：** 來自現有Excel報表，包含訂單號碼、客戶名稱、訂單日期、交期、狀態、物料編號、物料名稱、數量、預計到貨時間、缺料標誌等。
- **即時數據：** 考量未來整合Kafka/APIs的即時數據監控，如資源可用性、工單狀態、機台狀態等。

#### ETL（Extract, Transform, Load）流程建立：

- **使用SAS Studio建立ETL管線**，將原始Excel/CSV檔案匯入SAS平台。
- **執行數據清洗與標準化**，包括：
  - 去除重複數據、異常值（如負數工時）。
  - 統一員工與工序代碼格式，建立對應表。
  - 處理缺失值，進行標註或補齊。
  - 統一日期格式（例如轉換為標準SAS日期值）。
- **建立Analytic Base Table (ABT)**，作為所有分析與模型輸入的單一事實來源。

### 2.2 排程優化核心 (Optimization Core)

#### APS VM 演算法模組開發：

- **基於ABT數據**，使用SAS Optimization (PROC OPTMODEL) 建立混合整數線性規劃 (MILP) 模型。
- **模型將納入以下核心約束條件：**
  - **先後順序約束：** 確保任務依序執行。
  - **人力資源約束：** 考慮員工技能、單一技能瓶頸，確保每項任務指派給具備所需技能的員工。
  - **機台與設備約束：** 考慮設備可用性與限制。
  - **物料可用性約束：** 考慮物料到貨時間與庫存。
- **目標函數設定為最小化總完工時間 (Makespan)**。

#### 資料庫結構清單與更新流程文件：

- 定義模型輸入與輸出數據集的SAS資料庫結構（例如：`prod.fujitec_abt` 和 `prod.optimized_schedule`）。
- 建立數據更新流程文件，說明數據如何從來源系統進入SAS平台，並在模型運行前後進行更新。

### 2.3 決策支援與視覺化 (Decision Support & Visualization)

#### SAS Viya 分析模組製作：

- **在SAS Visual Analytics中建立互動式儀表板。**
- **核心視覺化組件包括：**
  - **甘特圖：** 呈現優化後的生產排程，顯示任務開始時間、結束時間、指派人員和機台。
  - **KPIs：** 顯示關鍵績效指標，如總完工時間、人力利用率、準時交貨率等。
  - **預排 vs 實排、標準工時 vs 實績差異分析：** 視覺化呈現排程效率與異常狀況。
- **「What-If」情境分析功能：**
  - 透過SAS VA參數功能，允許使用者選擇不同的預設情境（例如：「基準排程」、「關鍵焊工缺席」、「急單插入」），並即時觀察對排程和KPI的影響。

#### 定時排程流程與命名空間設定文件：

- 規劃SAS模型與儀表板的定時刷新機制，確保數據與排程的即時性。
- 定義SAS Viya環境中的命名空間（Libraries, Folders）設定，以確保專案資產的組織與權限管理。

### 2.4 智能自動化與系統整合 (Intelligent Automation & System Integration)

#### UiPath 郵件清理、異常通知分類、會議通知模組原型流程建立：

- **開發UiPath RPA機器人原型**，展示自動化報表處理能力。
- **郵件清理：** 處理特定郵件，提取關鍵資訊。
- **異常通知分類：** 自動識別並分類生產異常通知（例如：工時誤差超過±20%的異常註記）。
- **會議通知模組：** 根據排程變動或異常狀況，自動生成並發送會議通知。

#### 跨系統整合 API 與 Atom 元件架構圖完成：

- 設計SAS平台與外部系統（如RPA平台、ERP）之間的API整合架構。
- 使用PROC HTTP在SAS中發送REST API呼叫，將優化後的排程數據以JSON格式傳遞給RPA平台。
- 繪製跨系統整合架構圖，清晰展示數據流、API介面以及各系統之間的互動關係。此架構圖將參考dis_v0.1.1.html中的「End-to-End Solution Architecture」進行擴展與細化。

## 3. 測試資料集與測試案例

### 3.1 測試資料集生成

參考POC資料測試集規格文件_富士.pdf中的「測試資料需求摘要表格」與「資料處理建議與限制說明」，我們將生成以下測試資料集：

#### 工時與實績數據：

- **來源：** 模擬Fujitec_Work_Reporting.xlsx。
- **內容：** 包含過去一年的工時與實績數據，涵蓋正常、請假、缺工、異常等報工狀態。
- **特點：** 故意引入數據品質問題，例如：
  - 重複的員工報工記錄。
  - 實際工時欄位包含非數值字符或負數。
  - 報工日期格式不一致（例如：YYYY/MM/DD、MM-DD-YYYY、YYYYMMDD）。
  - 部分員工編號或工序代碼存在大小寫不一致或簡寫。
  - 缺失值（例如：實際工時未填報）。

#### PLM/製程設計數據：

- **來源：** 模擬Fujitec_PLM_Process.xlsx。
- **內容：** 包含工序代碼、工序名稱、需用技能、技能等級、設備需求、標準工時等。
- **特點：** 確保需用技能與員工技能之間存在多對多關係，並包含單一技能人員的數據，以驗證排班模型的約束處理能力。

#### ERP系統數據：

- **來源：** 模擬Fujitec_ERP_Data.xlsx。
- **內容：** 包含過去一年的客戶訂單、物料狀況、預排排程等資訊，需包含人力、工單、庫存、工站、工時等相關資訊。
- **特點：** 包含交期變動、物料延遲等情境數據，以驗證動態排程的應變能力。

### 3.2 測試案例設計

針對上述測試資料集，我們將設計以下測試案例：

#### 數據清洗與ABT生成測試：

- **案例1.1：** 驗證01_ingest_data.sas程式能否正確匯入所有原始Excel/CSV檔案。
- **案例1.2：** 驗證PROC FORMAT能否正確標準化不一致的員工編號和工序代碼。
- **案例1.3：** 驗證INPUT()函數與ANYDTDTE. informat能否正確轉換多種日期格式，並標記無法轉換的異常日期。
- **案例1.4：** 驗證數值欄位（如實際工時）的清洗邏輯，包括處理負數和非數值字符。
- **案例1.5：** 驗證PROC SORT與NODUPKEY選項能否正確移除重複的報工記錄。
- **案例1.6：** 驗證03_create_abt.sas程式能否正確將所有清洗後的數據整合為prod.fujitec_abt，並檢查數據完整性與一致性。

#### 排程優化模型測試：

- **案例2.1：** 驗證04_optimize_schedule.sas程式能否成功運行，生成prod.optimized_schedule數據集。
- **案例2.2：** 驗證Precedence_con約束條件是否確保任務的正確先後順序。
- **案例2.3：** 驗證SkillRequirement_con約束條件是否確保每項任務都指派給具備所需技能的員工，並處理單一技能瓶頸。
- **案例2.4：** 驗證模型是否能成功最小化總完工時間 (Makespan)。
- **案例2.5：** 模擬特定員工缺席情境，驗證模型是否能重新計算並生成新的優化排程。

#### 視覺化與決策支援測試：

- **案例3.1：** 驗證SAS Visual Analytics儀表板能否正確載入prod.optimized_schedule數據。
- **案例3.2：** 驗證甘特圖能否正確呈現任務排程、指派人員和機台。
- **案例3.3：** 驗證KPIs是否正確計算並顯示。
- **案例3.4：** 驗證「What-If」情境分析功能，切換不同情境時儀表板數據是否即時更新。

#### 自動化與系統整合測試：

- **案例4.1：** 驗證SAS PROC HTTP能否成功發送JSON payload到RPA平台API。
- **案例4.2：** 驗證UiPath機器人能否接收API呼叫，解析JSON數據。
- **案例4.3：** 驗證UiPath機器人能否自動打開Excel範本並填入優化後的排程數據。
- **案例4.4：** 驗證UiPath機器人能否執行郵件清理、異常通知分類、會議通知等原型流程。

## 4. SAS程式架構理解 (參考 dis_v0.1.1.html)

根據dis_v0.1.1.html文件，SAS程式架構主要圍繞著數據工程、優化、視覺化和自動化這四大核心部分展開。

### 4.1 數據工程 (Data Engineering)

- **目的：** 處理原始、雜亂的數據，將其轉換為可供分析和模型使用的乾淨、標準化的數據集。
- **主要工具/程式：**
  - **SAS Studio：** 作為主要的開發介面，用於編寫和執行SAS程式碼。
  - **LIBNAME 陳述式：** 用於為實體目錄（如 `/projects/fujitec/working_data/staging`）分配邏輯名稱，便於數據集管理。
  - **PROC IMPORT：** 用於從外部文件（如Excel .xlsx）匯入數據到SAS數據集。文件強調使用DBMS=XLSX直接讀取Excel，避免手動轉換問題。
  - **PROC FORMAT：** 用於定義數據的標準化映射，例如將不一致的員工ID標準化為統一格式。這比使用冗長的IF-THEN/ELSE語句更具可維護性。
  - **DATA Step：** SAS數據處理的核心，用於數據清洗、轉換、建立新變數、處理缺失值和異常值。例如，使用INPUT()函數和ANYDTDTE. informat處理日期格式不一致的問題，並使用??修飾符處理數值轉換失敗。
  - **PROC SORT：** 用於對數據進行排序，配合NODUPKEY選項有效移除重複記錄。
  - **PROC SQL：** 用於執行SQL查詢，將多個清洗後的數據集進行LEFT JOIN，最終建立Analytic Base Table (ABT)。
- **程式流程示例：**
  - **01_ingest_data.sas：** 負責將原始Excel文件匯入到staging庫。
  - 後續的SAS程式（如未明確命名，但邏輯上存在）會逐步對staging中的數據進行清洗、格式化、去重，並最終透過PROC SQL將其整合為prod.fujitec_abt。

### 4.2 優化核心 (Optimization Core)

- **目的：** 將業務排程問題轉化為數學模型，並利用優化演算法找到最佳解決方案。
- **主要工具/程式：**
  - **SAS Optimization (PROC OPTMODEL)：** SAS中用於建立和求解優化模型的強大工具。
  - **MILP (Mixed-Integer Linear Programming)：** 選擇的優化技術，因為它能提供最佳性保證，這對於證明智能系統優於手動排程至關重要。
- **程式流程示例：**
  - **04_optimize_schedule.sas：** 此程式會定義模型的集合、參數、決策變數、約束條件和目標函數。
  - **約束條件範例：**
    - **Precedence_con：** 確保任務先後順序（StartTime[t] >= StartTime[p] + TaskDuration[p]）。
    - **SkillRequirement_con：** 確保任務指派給具備所需技能的員工。
  - **目標函數範例：** MIN Objective = Makespan，最小化總完工時間。
  - **SOLVE WITH MILP：** 觸發MILP求解器找到最佳解。
  - **CREATE DATA：** 將求解器找到的最佳值（例如StartTime[t].sol）導出為新的SAS數據集prod.optimized_schedule。

### 4.3 決策支援與視覺化 (Decision Support & Visualization)

- **目的：** 將優化模型的數值結果轉化為直觀、可操作的商業智慧，支援管理決策。
- **主要工具：**
  - **SAS Visual Analytics (SAS VA)：** 用於建立互動式儀表板。
- **主要功能：**
  - **甘特圖：** 透過堆疊式水平長條圖實現，第一層為透明的任務開始時間，第二層為任務持續時間，呈現「浮動長條」效果。
  - **KPIs：** 顯示關鍵績效指標。
  - **「What-If」情境分析：** 透過SAS VA參數功能實現，允許使用者選擇不同情境，儀表板即時更新。

### 4.4 智能自動化 (Intelligent Automation)

- **目的：** 將分析結果與下游業務系統整合，實現自動化操作，解決「最後一哩路」問題。
- **主要工具/程式：**
  - **SAS PROC HTTP：** 用於發送HTTP請求，實現SAS與外部系統（如RPA平台）的API整合。
  - **RPA Bot (e.g., UiPath)：** 作為「雙手」，接收SAS的指令（透過API），執行重複性任務，如解析JSON、填寫Excel報告。
- **整合流程：**
  - SAS平台（「大腦」）透過PROC HTTP向RPA Orchestrator API發送JSON payload（包含優化後的排程數據）。
  - RPA Bot（「雙手」）接收API呼叫，解析JSON數據，並自動執行預設任務（例如，打開Excel模板，填入排程數據，或發送通知郵件）。

### 4.5 總體架構 (End-to-End Solution Architecture)

dis_v0.1.1.html中的SVG架構圖清晰地展示了整個解決方案的端到端流程，從數據源（Work Reporting, PLM/Process, ERP System, Real-time Data）經過SAS Analytics for IoT (SAS VIYA) 中的ETL管線、優化引擎、決策引擎和決策支援層，最終透過RPA Bot實現行動與自動化，將結果回饋給業務使用者。SAS與RPA之間的連接點是PROC HTTP進行的API呼叫。

## 5. 開發文件整合

本專案將確保開發團隊具備以下必要條件：

### 5.1 必要工具與存取清單

#### 作業系統與核心工具：

- **作業系統：** Ubuntu / Fedora (預設) - 已設定
- **套件管理器：** apt/dnf - 已設定

#### 開發環境：

- **IDE/程式碼編輯器：** VS Code, IntelliJ IDEA - 已安裝
- **版本控制系統：** Git - 已設定
- **容器化工具：** Docker - 已安裝
- **特定程式語言/運行時：** Node.js, Python, Java (如未來有擴展需求) - 已安裝

#### 公司系統：

- **電子郵件：** 企業郵箱帳戶 - 已啟用
- **即時通訊：** Slack / Microsoft Teams - 已加入

#### 存取憑證與網路：

- **VPN：** 內部網路存取 - 已設定
- **內部網路：** 存取內部資源 - 已存取
- **雲端帳戶：** GCP/AWS/Azure (如適用) - 已設定 (特指SAS Viya Public Cloud環境的存取)

### 5.2 關鍵技術文件連結

本專案將建立並維護以下關鍵技術文件，並提供相應連結：

#### 程式碼庫概覽：

- 主要程式碼庫與專案結構 (Git Repository Link)
- 關鍵模組與服務說明 (SAS Viya Services Documentation Link)

#### 開發環境設定：

- 本地開發環境設定指南 (SAS Studio Access Guide, UiPath Studio Setup Guide)
- 常見問題與疑難排解 (Internal Wiki/Confluence Link)

#### 編碼標準與實踐：

- 團隊編碼風格指南 (SAS Programming Best Practices, UiPath Development Guidelines)
- 命名約定與最佳實踐 (Data Naming Conventions for ABT, Model Variable Naming)
- 程式碼審查流程與規範 (Internal Code Review Process)

#### 版本控制工作流程：

- Git 分支策略與流程 (Gitflow/Trunk-based Development Guide)
- 提交訊息規範 (Commit Message Standards)
- 合併請求(PR)/合併請求(MR) 流程 (GitLab/GitHub/Bitbucket PR/MR Process)

#### 部署與測試：

- CI/CD 管道概覽 (SAS Viya Deployment Process, UiPath Orchestrator Deployment)
- 測試策略與框架 (Unit Testing, Integration Testing, UAT Plan)

#### API 文件：

- 內部 API 參考手冊 (SAS Job Execution API, UiPath Orchestrator API Documentation)
- 第三方整合說明 (External System API Specifications)

## 6. 專案交付物清單

本專案將交付以下關鍵成果：

- **APS VM 演算法模組：**
  - 04_optimize_schedule.sas 程式碼 (包含模型定義、約束條件、目標函數)。
  - 優化後的排程數據集 (prod.optimized_schedule)。

- **資料庫結構清單與更新流程文件：**
  - ABT (Analytic Base Table) 數據字典與結構定義。
  - 數據ETL流程文件，包含數據清洗、轉換、載入的詳細步驟。
  - SAS數據集更新頻率與機制說明。

- **UiPath 郵件清理、異常通知分類、會議通知模組原型流程：**
  - UiPath RPA流程文件與可執行原型。

- **SAS Viya 分析模組：**
  - SAS Visual Analytics 互動式儀表板報表文件。
  - 「What-If」情境分析配置說明。

- **定時排程流程與命名空間設定文件：**
  - SAS Job Execution Server 定時排程配置。
  - SAS Viya 環境命名空間與權限設定。

- **跨系統整合 API 與 Atom 元件架構圖：**
  - 詳細的系統整合架構圖 (更新並擴展dis_v0.1.1.html中的SVG圖)。
  - API介面規格文件 (SAS Job Execution API, UiPath Orchestrator API)。

## 7. 專案成功指標

本POC的成功將透過以下核心驗證指標來衡量：

- **數據整合與品質提升：**
  - **成功標準：** 成功生成 `prod.fujitec_abt` 資料集，並展示數據清洗前後的差異，證明系統能自動捕捉並處理潛在的數據錯誤。
  - **對應痛點：** 解決「資訊孤島」和「手動輸入易出錯」的問題，降低數據錯誤率。

- **智能化排程與效率提升：**
  - **成功標準：** 成功運行 `04_optimize_schedule.sas` 程式碼，產出 `prod.optimized_schedule` 資料集，並將此自動化過程與客戶目前的人工排程時間進行對比，證明排程時間顯著減少。
  - **對應痛點：** 解決「人工排程耗時」及「無法有效處理單一技能人力瓶頸」的問題。

- **決策可視性與應變能力：**
  - **成功標準：** 成功展示一個可互動的SAS Visual Analytics儀表板，管理者可在其中選擇不同的預設情境（如：基準、人員缺席），並看到儀表板的KPI和甘特圖立即更新，證明系統的決策支援能力。
  - **對應痛點：** 解決「資訊不透明」和「難以應對急單、設備故障等突發狀況」的問題。

- **自動化流程驗證：**
  - **成功標準：** 成功展示UiPath機器人原型，能夠接收SAS的API呼叫並自動執行報表填寫、郵件通知等任務。
  - **對應痛點：** 驗證自動化報表與資料轉換的可行性，減少人工作業。

## 8. 專案組織與推動策略

- **專案主導：** 建議由工廠廠長或指定具影響力的專案負責人主導推動，避免跨部門協調困難。
- **跨部門溝通：** 專案團隊將積極與富士達內部相關部門（生產、IT、PLM等）進行溝通，確保需求理解一致，並協同解決數據獲取與整合問題。
- **效益分析與規劃：** 專案需提供短中長期規劃與效益分析，協助部門爭取預算與高層支持，尤其是在PLM系統落實使用方面，將量化SAS平台透過數據分析帶來的效益（例如：設計變更週期縮短、替代料查找效率提升、BOM精確度提高等），並轉換為可監控的KPI指標。

## 9. 結論

本專案範疇與目標定義書為富士達電梯排程與資料整合平台技術驗證專案提供了清晰的藍圖。透過嚴謹的數據工程、強大的優化模型、直觀的決策支援以及智能自動化，我們將展示SAS Viya平台如何有效解決富士達目前的生產痛點，並為其未來的智能製造轉型提供堅實的技術基礎和商業價值。