---
title: 資料庫設計理念 (Database Design Philosophy)
sidebar_label: Database Design
---

# 資料庫設計理念：以任務為核心的聚合模型

在 Archon 專案中，我們選擇了一種「聚合的」或「整合的」資料庫設計模型，而不是為每個獨立的功能或使用案例建立分散的資料表。這個決策的核心是為了提升系統的擴充性、維護性與彈性。

## 核心思想

我們分析了專案中的主要使用案例，例如：

1.  **市場研究**: PM 指派 Agent 產生研究報告。
2.  **內部知識查詢**: 工程師指派 Agent 查詢內部文件並總結答案。
3.  **人機協作產出文件**: 行銷人員提供文案，指派 Agent 完成設計稿。

我們發現，這些案例的本質流程是共通的：

> **建立任務 → 指派 → 執行 → 更新狀態 → 附加產出**

基於這個觀察，我們沒有為「研究報告」或「設計稿」建立單獨的資料表，而是設計了一個**通用且彈性的 `archon_tasks` 資料表**作為所有工作的核心。

## 聚合模型的體現

這種聚合模型主要體現在 `archon_tasks` 資料表的設計上：

- **單一任務入口**: 所有的工作請求，無論其最終產出是什麼，都作為一個「任務」被記錄在 `archon_tasks` 表中。
- **彈性的產出欄位**: 我們透過一個 `attachments` 欄位（例如 `JSONB` 或 `TEXT[]` 型別）來儲存任務的最終產出。無論是研究報告的檔案路徑、一段總結文字，還是一個設計稿的 URL，都可以被記錄在這個欄位中。

這種設計的好處是，當未來需要支援新的使用案例時，只要它的核心流程符合「任務導向」，我們很可能不需要修改核心的資料庫結構，只需定義新的任務類型和處理對應的附件即可。

## `complete_setup.sql` 的角色

因此，`complete_setup.sql` 的目的就是建立起包含這張核心 `archon_tasks` 表在內的、能支援所有這些聚合流程的基礎資料庫結構。後續的功能（如 `attachments` 欄位或 `gemini_logs` 表）會再透過增量的遷移腳本 (migration scripts) 疊加上去，以保持資料庫變更的清晰可追溯。
