# 會話啟動標準作業程序 (Session Startup SOP)

> **【鐵律】此 SOP 為 Gemini 在每次新會話開始時，都必須嚴格遵守的首要步驟，旨在確保上下文同步，避免重複錯誤。**

1.  **第一步：強制讀取上下文**
    在回應您的任何請求前，我**必須**先讀取 `GEMINI.md`、`TODO.md` 和 `CONTRIBUTING_tw.md` 的內容。

2.  **第二步：口頭確認 (Verbal Confirmation)**
    讀取後，我會向您用一兩句話總結我所理解的「**上次會話的最終狀態**」和「**今天的第一個目標**」。

3.  **第三步：取得您的確認**
    在您確認我對起點的理解無誤後，我才能開始執行第一個指令。

---

# Gemini 專案背景指令 (Project Briefing for Gemini)

> **【重要】關於本文件的說明**
> 
> 本文件 (`GEMINI.md`) 是 **Gemini 的短期工作日誌**，主要用於記錄最近幾次開發會話的摘要，以便在短期內快速恢復上下文。
> 
> 由於 AI 的記憶限制，這裡的內容是**滾動更新的**，舊的紀錄會被移除。
> 
> **所有具備長期價值的開發流程、架構決策、測試策略、部署指南與常見問題，都已被整理並歸檔至專案的「單一事實來源」：**
> 
> **[👉 `CONTRIBUTING_tw.md`](./CONTRIBUTING_tw.md)**
> 
> 在開始任何開發任務前，請優先閱讀 `CONTRIBUTING_tw.md`。

---

在新對話開始時，請先讀取此檔案中列出的文件，以快速了解專案的背景、規範與當前狀態。

## 必讀文件列表 (Must-Read File List)

1.  **`CONTRIBUTING_tw.md`**: **(最優先)** 了解詳細的開發流程、測試規範、部署策略以及常見問題的解決方案。
2.  **`TODO.md`**: 了解整體的開發藍圖與當前的任務進度。
3.  **`Makefile`**: 了解專案定義的標準指令 (例如 `make test-fe`, `make dev` 等)。
4.  **`docker-compose.yml`**: 了解專案的微服務架構以及它們之間的關係。

## 專案近期動態與結論 (Recent Project Updates & Key Decisions)

- **硬重置完成與新發現 (2025-09-17)**
  - **行動**: 成功執行 `git checkout 190f66f -- python/`，將 `python/` 目錄還原至乾淨的穩定狀態。
  - **發現**: 經檢查，`190f66f` 版本的 `Dockerfile.mcp` **已包含**必要的「髒同步」`COPY` 指令。因此，無需對 Dockerfile 進行修改。
  - **下一步**: 直接進入「按劇本驗證」流程，從靜態驗證 (`ruff check`) 開始。

- **策略轉向：放棄修補，執行硬重置 (2025-09-17)**
  - **背景**: 在多次嘗試修復 `Dockerfile.mcp` 和 `mcp_server.py` 後，使用者明確指出 Gemini 已陷入「為修改而修改」的惡性循環。當前 `python/` 工作目錄處於被嚴重污染的狀態。
  - **決策**: 根據 `CONTRIBUTING_tw.md` 的 1.6 號原則，決定放棄所有本地修改，執行 `git checkout 190f66f -- python/`，將 `python/` 目錄還原到一個乾淨的起點。

- **`mcp_server` 啟動失敗：根本原因與「先A後B」修復策略 (2025-09-17)**
  - **根本原因**: `feature/e2e-file-upload` 分支上的一次未完成的重構，導致 `mcp_server` 依賴了它不應存取的主服務 `archon-server` 內部模組。
  - **戰略決策 (「先A後B」)**: 為解除當前開發阻塞，我們決定：
    1.  **短期 (A)**: 立刻恢復 `spike` 分支的「髒同步」作法，優先讓環境穩定。
    2.  **長期 (B)**: 在當前任務完成後，再開新分支，對 `mcp_server` 進行徹底的架構重構。

- **重大流程轉向與根本原因分析 (2025-09-17)**:
  - **背景**: 在經歷了近三週反覆的「改A壞B」循環後，使用者對 Gemini 的工作方法提出全面質疑。
  - **根本原因分析**：確認 `mcp_server` 的問題源於一次未完成的重構。
  - **結論與新的合作契約**: 建立了包含「目標優先、歷史為鑑、文件為綱、拒絕循環」的四項新工作原則。
