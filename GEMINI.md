# 會話啟動標準作業程序 (Session Startup SOP)

> **【鐵律】此 SOP 為 Gemini 在每次新會話開始時，都必須嚴格遵守的首要步驟，旨在確保上下文同步，避免重複錯誤。**

1.  **第一步：強制讀取上下文**
    在回應您的任何請求前，我**必須**先讀取 `GEMINI.md`、`TODO.md` 和 `CONTRIBUTING_tw.md` 的內容。

2.  **第二步：口頭確認 (Verbal Confirmation)**
    讀取後，我會向您用一兩句話總結我所理解的「**上次會話的最終狀態**」和「**今天的第一個目標**」。

3.  **第三步：取得您的確認**
    在您確認我對起點的理解無誤後，我才能開始執行第一個指令。

---

# Gemini 專案背景指令 (Project Briefing for Gemini)

> **【重要】關於本文件的說明**
> 
> 本文件 (`GEMINI.md`) 是 **Gemini 的短期工作日誌**，主要用於記錄最近幾次開發會話的摘要，以便在短期內快速恢復上下文。
> 
> 由於 AI 的記憶限制，這裡的內容是**滾動更新的**，舊的紀錄會被移除。
> 
> **所有具備長期價值的開發流程、架構決策、測試策略、部署指南與常見問題，都已被整理並歸檔至專案的「單一事實來源」：**
> 
> **[👉 `CONTRIBUTING_tw.md`](./CONTRIBUTING_tw.md)**
> 
> 在開始任何開發任務前，請優先閱讀 `CONTRIBUTING_tw.md`。

---

在新對話開始時，請先讀取此檔案中列出的文件，以快速了解專案的背景、規範與當前狀態。

## 必讀文件列表 (Must-Read File List)

1.  **`CONTRIBUTING_tw.md`**: **(最優先)** 了解詳細的開發流程、測試規範、部署策略以及常見問題的解決方案。
2.  **`TODO.md`**: 了解整體的開發藍圖與當前的任務進度。
3.  **`Makefile`**: 了解專案定義的標準指令 (例如 `make test-fe`, `make dev` 等)。
4.  **`docker-compose.yml`**: 了解專案的微服務架構以及它們之間的關係。

## 專案近期動態與結論 (Recent Project Updates & Key Decisions)

- **最終結論：解決「改A壞B」的唯一路徑 (2025-09-17)**
  - **問題**: 如何從根本上解決「改A壞B」的惡性循環。
  - **結論**: 只有「長期的重構計畫」（路徑B）才能從根本上解決問題。該計畫旨在修正 `mcp_server` 的錯誤架構，使其回歸「啞終端」的角色，讓程式碼實現與 `CONTRIBUTING.md` 的架構設計原則（無直接導入）完全一致。
  - **策略**: 我們採用的「先A後B」策略，是在承認上述結論的前提下，做出的務實選擇。我們先用「恢復髒同步」（路徑A）來快速穩定當前被阻塞的開發環境，以完成「整合 `enduser-ui-fe`」的主線任務。然後，再開啟新的、乾淨的分支，來執行「真重構」（路徑B），以絕後患。

- **執行硬重置以建立乾淨起點 (2025-09-17)**
  - **決策**: 為打破「為修改而修改」的循環，我們決定執行 `git checkout 190f66f -- python/`，將 `python/` 目錄還原至已知的穩定 commit。
  - **結果**: 成功清除了工作區的混亂狀態，為後續工作提供了乾淨的基礎。

- **`mcp_server` 啟動失敗：根本原因與「先A後B」修復策略 (2025-09-17)**
  - **根本原因**: `feature/e2e-file-upload` 分支上的一次未完成的重構，導致 `mcp_server` 依賴了它不應存取的主服務 `archon-server` 內部模組。
  - **戰略決策 (「先A後B」)**: 為解除當前開發阻塞，決定先恢復「髒同步」（路徑A），再計畫徹底重構（路徑B）。

- **重大流程轉向與根本原因分析 (2025-09-17)**:
  - **背景**: 在經歷了近三週反覆的失敗後，我們共同確立了新的工作契約。
  - **結論與新的合作契約**: 建立了包含「目標優先、歷史為鑑、文件為綱、拒絕循環」的四項新工作原則。

### **2025-09-17 會話總結與最終結論**

-   **目標**: 解決 `mcp-server` 因架構問題啟動失敗。
-   **最終結論**: `spike` 分支的成功有其特定環境因素（該環境已不可考），其髒程式碼無法作為當前 `feature` 分支的直接範本。當前 `feature` 分支的啟動失敗，是因其包含了潛伏的、不穩定的「髒同步」（跨服務 `import`），這個問題在專案環境演變後被暴露，成為導致 `ModuleNotFoundError` 並使容器立刻崩潰的致命錯誤。
-   **關鍵證據**:
    1.  `deployment_verification_log.txt` 顯示 `spike` 分支過去的問題是資料庫遷移，而非啟動崩潰。
    2.  `git diff` 顯示 `spike` 和 `feature` 分支的程式碼及關鍵設定檔 (`docker-compose.yml`, `pyproject.toml`) 幾乎完全相同。
-   **核心教訓**: 必須在通盤分析所有相關檔案（`.py`, `.yml`, `Makefile`, `.md` 紀錄, `git` 歷史）後，才能制定修復計畫。禁止在資訊不全的情況下，提出創造性的、未經驗證的修改。